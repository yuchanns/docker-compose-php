FROM php:7.2-fpm-alpine

WORKDIR /www

ENV TZ=Asia/Shanghai

RUN sed -i "s/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g" /etc/apk/repositories \
    && apk update && apk add --no-cache \
        libpng-dev make gcc musl-dev openssh-server openssh \
		g++ zlib-dev imagemagick imagemagick-dev \
		autoconf bash vim git wget zsh \
    && docker-php-ext-install -j$(nproc) gd bcmath sockets zip pdo_mysql pcntl \
	&& pecl install imagick redis && docker-php-ext-enable redis imagick \
    && php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');" \
    && php composer-setup.php \
    && rm composer-setup.php \
    && mv composer.phar composer \
    && ./composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/ \
	&& wget http://static.tjx.be/vim-vide.tgz && tar xvf ./vim-vide.tgz -C /root \
	&& apk del make gcc musl-dev g++ zlib-dev autoconf libpng-dev \
	&& rm vim-vide.tgz \
	&& git config --global user.email "airamusume@gmail.com" \
	&& git config --global user.name "yuchanns"

COPY ./.zshrc /root/

EXPOSE 9000

CMD ["php-fpm"]
